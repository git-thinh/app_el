!function (e) { if ("object" == typeof exports && "undefined" != typeof module) module.exports = e(); else if ("function" == typeof define && define.amd) define([], e); else { ("undefined" != typeof window ? window : "undefined" != typeof global ? global : "undefined" != typeof self ? self : this).PromiseWorker = e() } }(function () { return function e(t, n, r) { function o(u, s) { if (!n[u]) { if (!t[u]) { var c = "function" == typeof require && require; if (!s && c) return c(u, !0); if (i) return i(u, !0); var a = new Error("Cannot find module '" + u + "'"); throw a.code = "MODULE_NOT_FOUND", a } var f = n[u] = { exports: {} }; t[u][0].call(f.exports, function (e) { var n = t[u][1][e]; return o(n || e) }, f, f.exports, e, t, n, r) } return n[u].exports } for (var i = "function" == typeof require && require, u = 0; u < r.length; u++)o(r[u]); return o }({ 1: [function (e, t, n) { (function (e) { "use strict"; var n, r, o = e.MutationObserver || e.WebKitMutationObserver; if (o) { var i = 0, u = new o(f), s = e.document.createTextNode(""); u.observe(s, { characterData: !0 }), n = function () { s.data = i = ++i % 2 } } else if (e.setImmediate || void 0 === e.MessageChannel) n = "document" in e && "onreadystatechange" in e.document.createElement("script") ? function () { var t = e.document.createElement("script"); t.onreadystatechange = function () { f(), t.onreadystatechange = null, t.parentNode.removeChild(t), t = null }, e.document.documentElement.appendChild(t) } : function () { setTimeout(f, 0) }; else { var c = new e.MessageChannel; c.port1.onmessage = f, n = function () { c.port2.postMessage(0) } } var a = []; function f() { var e, t; r = !0; for (var n = a.length; n;) { for (t = a, a = [], e = -1; ++e < n;)t[e](); n = a.length } r = !1 } t.exports = function (e) { 1 !== a.push(e) || r || n() } }).call(this, "undefined" != typeof global ? global : "undefined" != typeof self ? self : "undefined" != typeof window ? window : {}) }, {}], 2: [function (e, t, n) { "use strict"; var r = e(1); function o() { } var i = {}, u = ["REJECTED"], s = ["FULFILLED"], c = ["PENDING"]; function a(e) { if ("function" != typeof e) throw new TypeError("resolver must be a function"); this.state = c, this.queue = [], this.outcome = void 0, e !== o && p(this, e) } function f(e, t, n) { this.promise = e, "function" == typeof t && (this.onFulfilled = t, this.callFulfilled = this.otherCallFulfilled), "function" == typeof n && (this.onRejected = n, this.callRejected = this.otherCallRejected) } function l(e, t, n) { r(function () { var r; try { r = t(n) } catch (t) { return i.reject(e, t) } r === e ? i.reject(e, new TypeError("Cannot resolve promise with itself")) : i.resolve(e, r) }) } function h(e) { var t = e && e.then; if (e && "object" == typeof e && "function" == typeof t) return function () { t.apply(e, arguments) } } function p(e, t) { var n = !1; function r(t) { n || (n = !0, i.reject(e, t)) } function o(t) { n || (n = !0, i.resolve(e, t)) } var u = d(function () { t(o, r) }); "error" === u.status && r(u.value) } function d(e, t) { var n = {}; try { n.value = e(t), n.status = "success" } catch (e) { n.status = "error", n.value = e } return n } t.exports = a, a.prototype.catch = function (e) { return this.then(null, e) }, a.prototype.then = function (e, t) { if ("function" != typeof e && this.state === s || "function" != typeof t && this.state === u) return this; var n = new this.constructor(o); this.state !== c ? l(n, this.state === s ? e : t, this.outcome) : this.queue.push(new f(n, e, t)); return n }, f.prototype.callFulfilled = function (e) { i.resolve(this.promise, e) }, f.prototype.otherCallFulfilled = function (e) { l(this.promise, this.onFulfilled, e) }, f.prototype.callRejected = function (e) { i.reject(this.promise, e) }, f.prototype.otherCallRejected = function (e) { l(this.promise, this.onRejected, e) }, i.resolve = function (e, t) { var n = d(h, t); if ("error" === n.status) return i.reject(e, n.value); var r = n.value; if (r) p(e, r); else { e.state = s, e.outcome = t; for (var o = -1, u = e.queue.length; ++o < u;)e.queue[o].callFulfilled(t) } return e }, i.reject = function (e, t) { e.state = u, e.outcome = t; for (var n = -1, r = e.queue.length; ++n < r;)e.queue[n].callRejected(t); return e }, a.resolve = function (e) { if (e instanceof this) return e; return i.resolve(new this(o), e) }, a.reject = function (e) { var t = new this(o); return i.reject(t, e) }, a.all = function (e) { var t = this; if ("[object Array]" !== Object.prototype.toString.call(e)) return this.reject(new TypeError("must be an array")); var n = e.length, r = !1; if (!n) return this.resolve([]); var u = new Array(n), s = 0, c = -1, a = new this(o); for (; ++c < n;)f(e[c], c); return a; function f(e, o) { t.resolve(e).then(function (e) { u[o] = e, ++s !== n || r || (r = !0, i.resolve(a, u)) }, function (e) { r || (r = !0, i.reject(a, e)) }) } }, a.race = function (e) { var t = this; if ("[object Array]" !== Object.prototype.toString.call(e)) return this.reject(new TypeError("must be an array")); var n = e.length, r = !1; if (!n) return this.resolve([]); var u = -1, s = new this(o); for (; ++u < n;)c = e[u], t.resolve(c).then(function (e) { r || (r = !0, i.resolve(s, e)) }, function (e) { r || (r = !0, i.reject(s, e)) }); var c; return s } }, { 1: 1 }], 3: [function (e, t, n) { "use strict"; var r = "undefined" != typeof Promise ? Promise : e(2), o = 0; function i(e, t) { var n = function (e) { try { return JSON.parse(e) } catch (e) { return !1 } }(t.data); if (n) { var r = n[0], o = n[1], i = n[2], u = e._callbacks[r]; u && (delete e._callbacks[r], u(o, i)) } } function u(e) { var t = this; t._worker = e, t._callbacks = {}, e.addEventListener("message", function (e) { i(t, e) }) } u.prototype.postMessage = function (e) { var t = this, n = o++, u = [n, e]; return new r(function (e, r) { t._callbacks[n] = function (t, n) { if (t) return r(new Error(t.message)); e(n) }; var o = JSON.stringify(u); if (void 0 !== t._worker.controller) { var s = new MessageChannel; s.port1.onmessage = function (e) { i(t, e) }, t._worker.controller.postMessage(o, [s.port2]) } else t._worker.postMessage(o) }) }, t.exports = u }, { 2: 2 }] }, {}, [3])(3) });